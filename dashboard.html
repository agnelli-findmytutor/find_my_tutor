<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - FindMyTutor</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body class="dashboard-body">

    <div class="animated-bg">
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
    </div>

    <div class="dashboard-layout">
        <!-- SIDEBAR -->
        <aside class="dashboard-sidebar">
            <div class="sidebar-brand">
                <i class="fas fa-graduation-cap"></i>
                <span>FindMyTutor</span>
            </div>

            <div class="sidebar-profile">
                <div class="profile-avatar">
                    <img src="https://via.placeholder.com/150" alt="Profilo" id="userAvatar">
                    <span id="profileRoleBadge" class="role-status-dot"></span>
                </div>
                <h2 id="userName">Caricamento...</h2>
                <p id="userEmail">...</p>
            </div>

            <nav class="sidebar-nav">
                <a href="index.html" class="nav-item"><i class="fas fa-home"></i> Home Sito</a>
                <a href="#" class="nav-item active" id="navDashboard"><i class="fas fa-th-large"></i> Dashboard</a>
                <a href="prenota.html" class="nav-item"><i class="fas fa-calendar-day"></i> Agenda Studente</a>
                <a href="appuntamenti.html" id="btnAgendaTutor" class="nav-item hidden"><i class="fas fa-chalkboard-teacher"></i> Agenda Tutor</a>
                <a href="#" id="navPcto" class="nav-item hidden"><i class="fas fa-medal"></i> PCTO</a>
                <div class="nav-spacer"></div>
                <button id="logoutBtn" class="nav-item logout-link"><i class="fas fa-sign-out-alt"></i> Disconnetti</button>
            </nav>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="dashboard-main">
            <header class="content-header">
                <div class="welcome-text">
                    <h1>Bentornato, <span id="welcomeName">...</span>!</h1>
                    <p>Ecco il riepilogo delle tue attività.</p>
                </div>
                <div class="header-actions">
                    <button id="btnDowngrade" class="btn-outline-warning hidden">
                        <i class="fas fa-user-minus"></i> Torna Studente
                    </button>
                    <button id="deleteBtn" class="btn-icon-danger" title="Elimina Account">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            </header>

            <!-- SEZIONE PANORAMICA (DEFAULT) -->
            <div id="tab-overview" class="dashboard-tab-content">
            <section class="activity-overview">
                <div class="section-title-main">
                    <h2><i class="fas fa-stream"></i> Attività e Feedback</h2>
                </div>
            <div class="dashboard-grid">
                <!-- LEZIONI STUDENTE -->
                <section class="grid-card">
                    <div class="card-title">
                        <i class="fas fa-book-reader"></i>
                        <h3>Lezioni da Frequentare (Studente)</h3>
                    </div>
                    <div id="studentLessonsList" class="lesson-mini-grid">
                        <p class="empty-msg">Nessuna lezione prenotata.</p>
                    </div>
                </section>

                <!-- LEZIONI TUTOR -->
                <section id="tutorLessonsSection" class="grid-card hidden">
                    <div class="card-title">
                        <i class="fas fa-chalkboard-teacher"></i>
                        <h3>Lezioni da Svolgere (Tutor)</h3>
                    </div>
                    <div id="tutorLessonsList" class="lesson-mini-grid">
                        <p class="empty-msg">Nessuna lezione in programma.</p>
                    </div>
                </section>

                <!-- VALUTAZIONE TUTOR -->
                <section id="tutorRatingSection" class="grid-card rating-card hidden">
                    <div class="card-title">
                        <i class="fas fa-star"></i>
                        <h3>Feedback e Valutazioni</h3>
                    </div>
                    <div class="rating-display">
                        <div id="tutorStars" class="stars"></div>
                        <p id="ratingText">Media recensioni</p>
                    </div>
                </section>
            </div>
            </section>
            </div>

            <!-- NUOVA SEZIONE PCTO (SOLO TUTOR) -->
            <div id="tab-pcto" class="dashboard-tab-content hidden">
                <section class="pcto-section">
                    <div class="section-title-main">
                        <h2><i class="fas fa-medal"></i> Ore PCTO Accumulate</h2>
                        <p>Le ore vengono conteggiate automaticamente al termine di ogni lezione.</p>
                    </div>
                    
                    <div class="pcto-display-card">
                        <div class="pcto-main-stat">
                            <span id="pctoHours" class="pcto-number">0</span>
                            <span class="pcto-unit">Ore Totali</span>
                        </div>
                        
                        <div id="pctoExtraMinutes" class="pcto-extra-box hidden">
                            <div class="extra-badge">+30 min</div>
                            <p>Hai una mezza ora in attesa di essere completata.</p>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

<div id="downgradeModal" class="modal-overlay hidden">
        <div class="modal-card">
            <div class="modal-icon warning">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h3>Attenzione: Cambio Ruolo</h3>
            <p>
                Stai per rinunciare al ruolo di Tutor. 
                <br><br>
                <strong>Prima di procedere:</strong> assicurati di non avere lezioni in sospeso. 
                La tua attuale candidatura verrà archiviata e dovrai ricompilarla se vorrai tornare Tutor.
            </p>
            <div class="modal-actions">
                <button id="btnCancelDowngrade" class="btn-modal secondary">Annulla</button>
                <button id="btnConfirmDowngrade" class="btn-modal danger">Procedi</button>
            </div>
        </div>
    </div>

    <div id="downgradeStep2Modal" class="modal-overlay hidden">
        <div class="modal-card">
            <div class="modal-icon warning">
                <i class="fas fa-question-circle"></i>
            </div>
            <h3>Sei proprio sicuro?</h3>
            <p>
                Questa è l'ultima conferma. Perdendo il ruolo di Tutor non potrai più gestire le tue lezioni attuali.
            </p>
            <div class="modal-actions">
                <button id="btnCancelDowngrade2" class="btn-modal secondary">Torna Indietro</button>
                <button id="btnFinalConfirmDowngrade" class="btn-modal danger">Sì, Torna Studente</button>
            </div>
        </div>
    </div>

    <div id="deleteAccountModal" class="modal-overlay hidden">
        <div class="modal-card">
            <div class="modal-icon warning" style="background: #ffebee; color: #d32f2f;">
                <i class="fas fa-user-times"></i>
            </div>
            <h3 style="color: #d32f2f;">Elimina Account</h3>
            <p>
                Stai per eliminare definitivamente il tuo profilo. Questa azione è <strong>irreversibile</strong> e comporterà la perdita di tutti i tuoi dati e prenotazioni.
            </p>
            <div class="modal-actions">
                <button id="btnCancelDelete" class="btn-modal secondary">Annulla</button>
                <button id="btnConfirmDeleteAccount" class="btn-modal danger" style="background: #d32f2f;">Elimina Definitivamente</button>
            </div>
        </div>
    </div>

    <div id="successModal" class="modal-overlay hidden">
        <div class="modal-card">
            <div class="modal-icon success">
                <i class="fas fa-check"></i>
            </div>
            <h3>Operazione Completata</h3>
            <p>
                Il tuo ruolo è stato aggiornato correttamente.
                <br>
                Ora sei uno <strong>Studente</strong>.
            </p>
            <button id="btnSuccessClose" class="btn-modal success-btn" style="width:100%">
                OK, Ricarica Pagina
            </button>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/gestione_utente.js"></script>
    <script src="script.js"></script>
    <script src="js/dashboard.js"></script>

</body>
</html>